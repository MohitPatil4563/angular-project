<div *ngIf="isLoading" class="spinner"></div>
<div class="container mt-4">
  <div class="row">
    <div class="col-12 text-end">
      <button class="btn btn-primary mb-2" (click)="openModal()">Add Employee</button>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <div class="card card-border">
        <table class="table caption-top" >
          <thead class="table-light">
            <tr>
              <th scope="col">First Name</th>
              <th scope="col">Last Name</th>
              <th scope="col">Email</th>
              <th scope="col">Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let emp of employees">
              <td>{{ emp.firstName }}</td>
              <td>{{ emp.lastName }}</td>
              <td>{{ emp.email }}</td>
              <td>
                <button type="button" class="btn btn-sm" title="Edit" (click)="openModal(true, emp.id)">
                  <i class="fas fa-pen"></i>
                </button>
                <button type="button" class="btn btn-sm" title="Delete" (click)="deleteEmployee(emp.id)">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>

        <!-- Pagination -->
        <tfoot class="pb-3">
          <tr class="d-flex">
            <td class="col-6">
              <div class="row ">
                <span class="col-2 mt-1">Show</span>
                <div class="col-3">
                  <select class="form-select form-select-sm custom-sm" [(ngModel)]="maTableEmployee.paging.pageSize"
                    name="pageSize" (change)="maTableEventEmployee(null, 'PageSizeChanged')">
                    <option *ngFor="let size of maTableEmployee.pageSizeList" [value]="size">
                      {{ size }}
                    </option>
                  </select>

                </div>
                <span class="col-7 mt-1">Total {{ maTableEmployee.paging.totalItems }}</span>
              </div>
            </td>
            <td class="col-6" colspan="4">
              <nav>
                <pagination [boundaryLinks]="true" [totalItems]="maTableEmployee.paging.totalItems"
                  class="justify-content-end mb-0" firstText="«" previousText="‹" nextText="›" lastText="»"
                  [maxSize]="maTableEmployee.maxLinkSize" (pageChanged)="maTableEventEmployee($event,'PageChanged')"
                  [itemsPerPage]="maTableEmployee.paging.pageSize">
                </pagination>
              </nav>
            </td>
          </tr>
        </tfoot>

      </div>
    </div>

    <!-- Modal Template -->
    <ng-template #employeeFormModal>
      <div class="modal-backdrop show" style="z-index: 1040;"></div>
      <div class="modal show d-block" tabindex="-1" style="z-index: 1050;">
        <div class="modal-dialog">
          <div class="modal-content">
            <form #empForm="ngForm" (ngSubmit)="onSubmit(empForm)">
              <div class="modal-header">
                <h5 class="modal-title">
                  {{ isEditMode ? 'Edit Employee' : 'Add New Employee' }}
                </h5>
                <button type="button" class="btn-close" (click)="closeModal()"></button>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <label>First Name <span>*</span></label>
                  <input type="text" name="firstName" [(ngModel)]="employeeFormData.firstName" class="form-control" />
                </div>
                <div class="mb-3">
                  <label>Last Name <span>*</span></label>
                  <input type="text" name="lastName" [(ngModel)]="employeeFormData.lastName" class="form-control" />
                </div>
                <div class="mb-3">
                  <label>Email <span>*</span></label>
                  <input type="email" name="email" [(ngModel)]="employeeFormData.email" class="form-control" />
                </div>
                <div class="mb-3">
                  <label>Phone Number <span>*</span></label>
                  <input type="text" name="phoneNumber" [(ngModel)]="employeeFormData.phoneNumber"
                    class="form-control" />
                </div>
                <div class="mb-3">
                  <label>Street Address</label>
                  <input type="text" name="streetAddress" [(ngModel)]="employeeFormData.streetAddress"
                    class="form-control" />
                </div>
                <div class="mb-3">
                  <label>Suburb</label>
                  <input type="text" name="suburb" [(ngModel)]="employeeFormData.suburb" class="form-control" />
                </div>
                <div class="mb-3">
                  <label>Post Code</label>
                  <input type="text" name="postcode" [(ngModel)]="employeeFormData.postcode" class="form-control" />
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="closeModal()">
                  Close
                </button>
                <button type="submit" class="btn btn-primary" [disabled]="isLoading">
                  {{ isEditMode ? 'Update' : 'Save' }}
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </ng-template>

    <!-- Modal Display -->
    <ng-container *ngIf="modalOpen">
      <ng-container *ngTemplateOutlet="employeeFormModal"></ng-container>
    </ng-container>
  </div>